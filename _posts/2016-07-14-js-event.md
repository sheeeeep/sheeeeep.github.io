---
layout: post
title:  "事件"
categories: JavaScript
---

> 事件是指在浏览器中触发的动作。

## 事件的阶段

DOM2.0模型将事件处理流程分为三个阶段：

### 事件捕获阶段

**自顶向下**

当元素触发事件，顶层对象document就会发出一个事件流，随着DOM树的节点向目标元素节点流去，直到到达事件真正发生的目标元素。

### 事件目标阶段
当到达目标元素之后，执行目标元素该事件相应的处理函数。

### 事件起泡阶段

**自底向上**

从目标元素开始，往顶层元素传播。途中如果有节点绑定了相应的事件处理函数，这些函数都会被一次触发。
阻止事件起泡，```e.stopPropagation()```（Firefox）||```e.cancelBubble=true（IE）

## 处理事件

```
var EventUtil = {
  addHandler: function(element, type, handler){
    if (element.addEventListener) {
      element.addEventListener(type, handler, false);
    }
    else if (element.attachEvent){
      element.attachEvent('on' + type, handler);
    }
    else {
      element['on' + type] = handler;
    }
  },
  removeHandler: function(element, type, handler){
    if (element.addEventListener) {
      element.removeEventListener(type, handler, false);
    }
    else if (element.attachEvent){
      element.dettachEvent('on' + type, handler);
    }
    else {
      element['on' + type] = null;
    }
  }
}
```

## 事件代理
把事件处理器添加到一个元素上，等待一个事件从它的子级元素里冒泡上来，并且可以得知这个事件是从哪个元素开始的。

```e.target.nodeName``` ： 判断是否是要处理的节点
```e.target``` ： 拿到被点击的节点

事件代理的优点：当需要给大量的元素或者动态生成的元素添加事件处理的时候，如果给元素本身添加事件处理就会增加复杂度。

## 自定义事件

### 纯JS自定义事件

设定一个数组对象，该对象中，每个数组对应一种事件类型。添加事件：往对应事件类型数组push方法；删除事件：往对应事件类型数组pop方法；执行事件：取出对应事件类型执行；

### 自定义DOM事件

1. 标准方法
自定义事件添加以后需要进行创建```var evt = document.createEvent("HTMLEvents")```和初始化```evt.initEvent("alert", false, false)```才能够触发```dom.dispatchEvent(evt)```

2. IE方法
IE不支持```createEvent()```方法。但是可以给元素添加自定义属性，当属性发生改变时，IE有```onpropertychange```事件会触发

## 事件方法的兼容性


| -   | 事件 | 发生事件的对象  | 绑定事件的对象 | 阻止冒泡	| 阻止默认行为 |事件类型|
|:--: | :-: | :------------:| :---------: |:---------: |:---------: |:---------: |
| DOM |event|target	       | event.currenteTarget 或 this |stopPropagation|preventDefault	|type|
|IE   |event或window.event|srcElement|?|cancelBubble|returnValue = false|type|

