---
layout: post
title:  "每天一章《高性能JavaScript》—2. 数据访问"
categories: JavaScript
---

## 基础

### 基本数据访问位置
直接量、变量、数据项、对象成员

### 作用域链 ：

作用域链有两个含义：

- 函数的作用域链
- 函数的运行上下文的作用域链

**函数的作用域链**
定义：函数作为一个对象，拥有可访问的属性和不可访问的内部属性，[[scope]]是不可访问的内部属性之一，被称为函数的作用域链。其中存储着函数作用域中对象的集合，对象以键值对的形式存储，代表此函数环境中可访问的数据。

形成：函数创建后，作用域链中会首先填入全局变量

**函数的运行上下文的作用域链**
定义：函数每次运行都会创建一个单独的运行上下文，每个运行上下文有单独的作用域链。

形成：

- 运行上下文创建时，用函数的[[scope]]初始化自己的作用域链
- 创建激活对象，包含所有局部变量，命名参数，this等，推入作用域链的顶部

函数运行时，通过搜索运行上下文的作用域链查找标识符。作用域链从首部开始查找，如果没找到，则进入作用域链的下一个对象。

### 原型

定义：同类型实例共享的一个对象

- 对象的内部属性 ```_proto_```能够访问对象的原型
- ```prototype```是构造器原型
- 判断实例成员：```hasOwnProperty(...)```
- 判断实例成员和原型成员：```in```

## 标识符识别
**How to do**

> 用**局部变量存储**会经常访问的局部范围之外的变量

**why**
标识符位于作用域链中的位置越深，访问就越慢。

## 访问对象成员
**How to do**

> 用**局部变量存储**会经常访问的嵌套较深的对象成员

**why**

- 对象成员的访问比直接量、局部量访问慢，有些浏览器上比访问数组项更慢
- 在原型链上的搜索，深度越深，速度越慢
- 对象成员嵌套越深，速度越慢：```window.location.href```比```location.href```慢

## 改变作用域链
**How to do**

> 不改变作用域链

**why**

- ```with(...)```: 创建一个新的对象插入作用域链的前端，使得访问代价更高
- ```catch{...}```: 创建异常对象推入作用域链顶端，执行完作用域链恢复
- 以上方法都创建了动态作用域，使得JS引擎的优化无效

## 闭包
**How to do**

> 谨慎使用闭包，将常用域外变量存入局部变量中

**why**

- 当闭包的[[scope]]属性包含了对激活对象的引用，激活对象无法销毁，导致运行期上下文也无法销毁。产生了更多的内存开销
- IE使用非本地JS对象实现DOM对象，闭包可能导致内存泄露
- 闭包执行时的运行期上下文的作用域链常常要去访问引用于父函数的变量（位于作用域链第二位置），也会产生性能开销

